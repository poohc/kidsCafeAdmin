<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.swings.main">
	
	<select id="selectDashboardViewInfo" parameterType="map" resultType="map">
		SELECT (SELECT COUNT(*) 
				  FROM GOODSSALEINFO
				 WHERE CANCELFLAG = '0'
				   AND LEFT(INDATE, 8) = #{today}      
				   <if test="franchiseStatus != null and (franchiseStatus eq '0'.toString())">
				   AND FRANCHISEENUM = #{franchiseNum}
				   </if>
				   AND (CHARINDEX('입장', GOODSNAME) > 0 OR CHARINDEX('단체', GOODSNAME) > 0)) ENT_MEMBER,
			   (SELECT ISNULL(SUM(CONVERT(INT, PRICE)), 0) PRICE
				  FROM CARDOKDATAINFO
				 WHERE CANCEL = '0'
				   <if test="franchiseStatus != null and (franchiseStatus eq '0'.toString())">
				   AND FRANCHISEENUM = #{franchiseNum}
				   </if>
				   AND LEFT(DATE, 8) = #{today}) TOTAL_PRICE,
		       (SELECT COUNT(*)
				  FROM MEMBERINFO
				 WHERE JOINDATE = #{today}
				   <if test="franchiseStatus != null and (franchiseStatus eq '0'.toString())">
				   AND FRANCHISEENUM = #{franchiseNum}
				   </if>
				   ) TODAY_JOIN_MEMBER,
			   (SELECT IsNULL(SUM(NUM), 0)
				  FROM GoodsSaleInfo
				 WHERE CHARINDEX('*[소셜]',GoodsName) > 0
				   AND CancelFlag = '0'
				   <if test="franchiseStatus != null and (franchiseStatus eq '0'.toString())">
				   AND FranchiseeNum = #{franchiseNum} 
				   </if>
				   AND LEFT(InDate, 8) = #{today}) SNS_COUNT
	</select>
	
	
</mapper>